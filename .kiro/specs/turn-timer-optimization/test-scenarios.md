# テストシナリオ - 手番タイマー最適化

## テスト環境

- ブラウザで2つのタブを開き、それぞれ異なるプレイヤーとしてゲームに参加
- 開発者ツールのコンソールでログを確認

## テストシナリオ1: 通常の手番（タイマーなし）

### 前提条件
- 2人のプレイヤーがゲームに参加
- どちらもリーチしていない

### 手順
1. プレイヤーAの手番が開始される
2. 自動的に牌が引かれる

### 期待される結果
- ✓ タイマーが表示されない
- ✓ コンソールに「タイマースキップ: 自動牌引きが実行されました」と表示される
- ✓ プレイヤーAが牌を捨てる操作ができる

### 確認ポイント
- 画面右上にタイマーが表示されないこと
- ゲームの流れがスムーズであること

---

## テストシナリオ2: ロン待機状態（タイマーあり）

### 前提条件
- プレイヤーAがリーチを宣言している
- プレイヤーBが牌を捨てる

### 手順
1. プレイヤーBが牌を捨てる
2. プレイヤーAにロン判定が実行される
3. ロン可能な場合、ロンボタンが表示される

### 期待される結果
- ✓ プレイヤーAにロンボタンが表示される
- ✓ コンソールに「ロン待機状態を設定」と表示される
- ✓ タイマーが表示される（ロン待機中）
- ✓ 10秒後に自動的にロン待機状態が解除される

### 確認ポイント
- ロンボタンが表示されること
- タイマーが表示されること
- 10秒後にロンボタンが消えること

---

## テストシナリオ3: ロン宣言後の状態クリア

### 前提条件
- プレイヤーAがロン待機状態
- ロンボタンが表示されている

### 手順
1. プレイヤーAがロンボタンをクリック
2. ゲームが終了する

### 期待される結果
- ✓ ロン待機状態が解除される
- ✓ タイマーがクリアされる
- ✓ ゲーム終了画面が表示される

### 確認ポイント
- ロン待機状態が正しくクリアされること
- メモリリークが発生しないこと（タイムアウトが適切にクリアされること）

---

## テストシナリオ4: ロン待機キャンセル

### 前提条件
- プレイヤーAがロン待機状態
- ロンボタンが表示されている

### 手順
1. プレイヤーAがロンボタンをクリックせずに待つ
2. 10秒経過する

### 期待される結果
- ✓ 10秒後にロン待機状態が自動的に解除される
- ✓ ロンボタンが消える
- ✓ タイマーがクリアされる
- ✓ 自動的に牌が引かれる（プレイヤーAの手番の場合）

### 確認ポイント
- タイムアウトが正しく動作すること
- ロン待機状態が自動的にクリアされること

---

## テストシナリオ5: エラーハンドリング

### 前提条件
- ゲームが進行中

### 手順
1. 意図的にネットワークを切断する
2. 再接続する

### 期待される結果
- ✓ エラーが発生してもゲームがクラッシュしない
- ✓ 適切なエラーログが記録される
- ✓ ロン待機状態が不整合にならない

### 確認ポイント
- エラーハンドリングが適切に動作すること
- ゲーム状態が破損しないこと

---

## デバッグログの確認

### サーバー側のログ
以下のログメッセージを確認してください：

- `タイマースキップ: 自動牌引きが実行されました`
- `タイマー起動: ロン待機状態です`
- `タイマースキップ: 通常状態です`
- `ロン待機状態を設定`
- `ロン待機タイムアウト - 自動解除`
- `ロン待機状態キャンセル完了`

### クライアント側のログ
以下のログメッセージを確認してください：

- `自動牌引き要求を受信`
- `自動引き判定結果`
- `ロン判定結果`
- `ロン可能です！`

---

## パフォーマンステスト

### 確認項目
1. タイマー起動回数が削減されていること
2. 不要なネットワークトラフィックが削減されていること
3. UI更新の頻度が適切であること

### 測定方法
- ブラウザの開発者ツールでネットワークタブを確認
- `turnTimerStarted`イベントの送信回数を確認
- ゲームプレイ中のCPU使用率を確認

---

## 回帰テスト

### 既存機能の確認
1. 通常の牌の引き・捨てが正常に動作すること
2. リーチ宣言が正常に動作すること
3. ツモ上がりが正常に動作すること
4. ロン上がりが正常に動作すること
5. ゲーム終了処理が正常に動作すること

### 確認方法
- 各機能を実際にプレイして動作を確認
- エラーが発生しないことを確認
- ゲームの流れが自然であることを確認
