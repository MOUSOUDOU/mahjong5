# 実装計画

- [ ] 1. サーバーサイド判定エンジンの実装
  - JudgmentEngine.jsクラスを新規作成
  - 自動引き判定ロジック（canAutoDraw）を実装
  - 自摸和了判定ロジック（checkTsumo）を実装
  - ロン判定ロジック（checkRon）を実装
  - リーチ宣言判定ロジック（checkRiichi）を実装
  - _要件: 1.2, 2.2, 3.2, 4.2_

- [ ] 2. サーバーAPI エンドポイントの実装
  - server.jsに判定API エンドポイントを追加
  - queryAutoDraw イベントハンドラーを実装
  - queryTsumo イベントハンドラーを実装
  - queryRon イベントハンドラーを実装
  - queryRiichi イベントハンドラーを実装
  - 統一された応答フォーマットを実装
  - _要件: 5.1, 5.2_

- [ ] 3. ゲーム状態管理の拡張
  - GameStateクラスにisFirstTurn()メソッドを追加
  - 手番履歴管理機能を実装
  - 保留中の判定管理機能を実装
  - 最後に捨てられた牌の追跡機能を実装
  - _要件: 1.2, 1.3_

- [ ] 4. クライアントサイド判定クライアントの実装
  - JudgmentClient.jsクラスを新規作成
  - サーバーへの判定問い合わせ機能を実装
  - Promise ベースの非同期処理を実装
  - タイムアウト処理とエラーハンドリングを実装
  - _要件: 5.3, 5.4_

- [ ] 5. メインゲームロジックの統合
  - script.jsの手番開始処理を自動引き問い合わせに変更
  - 牌を引いた後の自摸判定問い合わせを実装
  - 相手の捨て牌に対するロン判定問い合わせを実装
  - 捨て牌選択時のリーチ判定問い合わせを実装
  - _要件: 1.1, 2.1, 3.1, 4.1_

- [ ] 6. エラーハンドリングと状態検証の実装
  - JudgmentErrorHandlerクラスを実装
  - StateValidatorクラスを実装
  - クライアントサイドのフォールバック処理を実装
  - 状態整合性チェック機能を実装
  - _要件: 5.2, 5.5_

- [ ]* 7. 判定履歴とログ機能の実装
  - Playerクラスに判定履歴管理を追加
  - 詳細なログ出力機能を実装
  - デバッグ用の判定トレース機能を実装
  - _要件: 5.5_

- [ ]* 8. パフォーマンス最適化の実装
  - 判定ロジックのキャッシュ化を実装
  - 並列判定処理の制限機能を実装
  - メモリ使用量の最適化を実装
  - _要件: 5.1_